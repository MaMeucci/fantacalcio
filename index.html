<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fantacalcio Drag&Drop</title>

<!-- Sortable.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
  background: #f4f6f8;
}

header {
  background: #111827;
  color: white;
  padding: 14px;
  text-align: center;
  font-weight: 600;
  font-size: 18px;
}

.container {
  padding: 12px;
}

input[type="file"] {
  width: 100%;
  margin-bottom: 12px;
}

select {
  width: 100%;
  padding: 12px;
  margin-bottom: 12px;
  border-radius: 12px;
  border: 1px solid #ccc;
  font-size: 16px;
}

.section {
  margin-bottom: 18px;
}

.section h2 {
  margin: 6px 0;
  font-size: 16px;
}

.players {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  min-height: 50px;
  padding: 6px;
  background: #f0f0f0;
  border-radius: 12px;
}

.player {
  padding: 10px 12px;
  border-radius: 12px;
  font-size: 14px;
  cursor: grab;
  user-select: none;
  background: #e5e7eb;
  transition: all .2s;
}

.player.selected {
  outline: 3px solid #000;
  background: white;
}

.p { background: #d1fae5; }
.d { background: #dbeafe; }
.c { background: #fef3c7; }
.a { background: #fee2e2; }

button {
  width: 100%;
  padding: 14px;
  border: none;
  border-radius: 14px;
  background: #2563eb;
  color: white;
  font-size: 16px;
  font-weight: 600;
}

textarea {
  width: 100%;
  height: 220px;
  margin-top: 12px;
  padding: 12px;
  border-radius: 12px;
  border: 1px solid #ccc;
  font-family: monospace;
  font-size: 14px;
}
</style>
</head>
<body>

<header>⚽ Fantacalcio Drag&Drop</header>

<div class="container">

<input type="file" id="fileInput" accept=".txt">

<select id="modulo" onchange="updateFormation()">
  <option value="3-4-3">3-4-3</option>
  <option value="4-3-3">4-3-3</option>
  <option value="4-4-2">4-4-2</option>
  <option value="3-5-2">3-5-2</option>
</select>

<div id="titolari" class="section"></div>
<div id="panchina" class="section"></div>

<button onclick="generateOutput()">Genera output</button>

<textarea id="output" placeholder="Output finale..."></textarea>

</div>

<script>
// Ruoli mappati
const roleMap = {
  Maignan: 'P', Terracciano: 'P', Torriani: 'P', Doneda: 'P',
  Rrahmani: 'D', Tomori: 'D', Caracciolo: 'D', Valeri: 'D',
  Scalvini: 'D', Beukema: 'D', Kelly: 'D', Vitik: 'D',
  Thorstvedt: 'C', Odgaard: 'C', Calhanoglu: 'C', 'Loftus-Cheek': 'C',
  Fabbian: 'C', Tramoni: 'C', Bailey: 'C',
  Thuram: 'A', "Soule'": 'A', Vardy: 'A', Vazquez: 'A',
  Pedro: 'A', Berardi: 'A'
};

let titolari = [];
let panchina = [];

// File input
document.getElementById('fileInput').addEventListener('change', e => {
  const reader = new FileReader();
  reader.onload = () => parseFile(reader.result);
  reader.readAsText(e.target.files[0]);
});

// Parsing
function parseFile(text) {
  const parts = text.trim().split(/\n\s*\n/);
  titolari = parseBlock(parts[0]);
  panchina = parseBlock(parts[1]);
  render();
  initDragDrop();
}

// Parse singolo blocco
function parseBlock(block) {
  return block.split('\n')
    .map(l => l.replace(';','').trim())
    .filter(Boolean)
    .map(name => ({
      name,
      role: roleMap[name] || 'C',
      selected: true
    }));
}

// Render
function render() {
  renderSection('Titolari', titolari, 'titolari');
  renderSection('Panchina', panchina, 'panchina');
}

// Render sezione
function renderSection(title, list, containerId) {
  const container = document.getElementById(containerId);
  container.innerHTML = `<h2>${title}</h2>`;
  const roleOrder = ['P','D','C','A'];
  roleOrder.forEach(r => {
    const players = list.filter(p => p.role === r);
    if (!players.length) return;
    const div = document.createElement('div');
    div.className = 'players';
    div.id = containerId+'-'+r;
    players.forEach(p => {
      const el = document.createElement('div');
      el.className = `player ${p.selected ? 'selected' : ''} ${r.toLowerCase()}`;
      el.textContent = p.name;
      el.setAttribute('draggable', true);
      div.appendChild(el);
    });
    container.appendChild(div);
  });
}

// Drag & Drop con Sortable.js
function initDragDrop() {
  ['titolari','panchina'].forEach(sec => {
    ['P','D','C','A'].forEach(r => {
      const el = document.getElementById(sec+'-'+r);
      if(el) Sortable.create(el, {
        group: 'players',
        animation: 150,
        onEnd: (evt) => {
          const name = evt.item.textContent;
          movePlayer(name, evt.to.id.split('-')[0]);
        }
      });
    });
  });
}

// Aggiorna array quando sposti giocatore
function movePlayer(name, dest) {
  let from = dest === 'titolari' ? panchina : titolari;
  let to = dest === 'titolari' ? titolari : panchina;

  const idx = from.findIndex(p => p.name === name);
  if(idx >=0){
    const [p] = from.splice(idx,1);
    to.push(p);
    render();
    initDragDrop();
  }
}

// Modulo
function updateFormation() {
  // per ora solo visuale, si può aggiungere validazione
  const modulo = document.getElementById('modulo').value;
  console.log('Modulo selezionato:', modulo);
}

// Output
function generateOutput() {
  const out = [];
  titolari.forEach(p => out.push(p.name + ';'));
  out.push('');
  panchina.forEach(p => out.push(p.name + ';'));
  document.getElementById('output').value = out.join('\n');
}

</script>
</body>
</html>
