<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fantacalcio Schiera formazione</title>
<style>
body { font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto; background:#f4f6f8; margin:0; }
header { background:#111827; color:white; padding:14px; text-align:center; font-weight:600; font-size:18px;}
.container{padding:12px;}
.section{margin-bottom:18px;}
.section h2{margin:6px 0;font-size:16px;}
.player-row{display:flex;align-items:center;gap:8px;padding:4px 0;}
.player-label{min-width:120px;}
select{padding:4px;border-radius:6px;border:1px solid #ccc;}
button{width:100%;padding:14px;border:none;border-radius:14px;background:#2563eb;color:white;font-size:16px;font-weight:600;margin-top:12px;}
textarea{width:100%;height:220px;margin-top:12px;padding:12px;border-radius:12px;border:1px solid #ccc;font-family:monospace;font-size:14px;}
</style>
</head>
<body>
<header>âš½ Fantacalcio Schiera formazione</header>
<div class="container">
<div id="titolari" class="section"></div>
<div id="panchina" class="section"></div>
<button onclick="generateOutput()">Genera output</button>
<textarea id="output" placeholder="Output finale..."></textarea>
</div>

<script>
let titolari=[], panchina=[];

// Carica rosa.txt
fetch('rosa.txt')
  .then(res => res.text())
  .then(text => {
    const parts = text.trim().split(/\n\s*\n/);
    titolari = parseBlock(parts[0]);
    panchina = parseBlock(parts[1]);
    render();
  })
  .catch(err => alert("Errore caricamento rosa.txt: " + err));

function parseBlock(block){
  return block.split('\n').filter(Boolean).map(line=>{
    const [role,name] = line.split(';').map(s=>s.trim());
    return {role,name};
  });
}

function render(){
  renderSection('Titolari', titolari, 'titolari');
  renderSection('Panchina', panchina, 'panchina');
}

function renderSection(title, arr, containerId){
  const container = document.getElementById(containerId);
  container.innerHTML = `<h2>${title}</h2>`;
  ['P','D','C','A'].forEach(r=>{
    const players = arr.filter(p=>p.role===r);
    if(!players.length) return;
    players.forEach((p,i)=>{
      const row = document.createElement('div');
      row.className='player-row';
      const label = document.createElement('div');
      label.className='player-label';
      label.textContent=`${r} - `;
      const select = document.createElement('select');
      // Lista giocatori disponibili per quel ruolo (titolari+panchina)
      const allPlayers = [...titolari,...panchina].filter(g=>g.role===r);
      allPlayers.forEach(g=>{
        const option = document.createElement('option');
        option.value=g.name;
        option.textContent=g.name;
        if(g.name===p.name) option.selected=true;
        select.appendChild(option);
      });
      select.addEventListener('change', e=>{
        p.name=e.target.value;
        render(); // aggiorna subito
      });
      row.appendChild(label);
      row.appendChild(select);
      container.appendChild(row);
    });
  });
}

// Output
function generateOutput(){
  const out=[];
  ['titolari','panchina'].forEach(sec=>{
    const arr = sec==='titolari'?titolari:panchina;
    ['P','D','C','A'].forEach(r=>{
      arr.filter(p=>p.role===r).forEach(p=>out.push(p.role+';'+p.name+';'));
    });
    if(sec==='titolari') out.push('');
  });
  document.getElementById('output').value = out.join('\n');
}
</script>
</body>
</html>
